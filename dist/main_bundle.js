(()=>{"use strict";const e=document.querySelector("body"),t=document.querySelector(".img-upload__form"),n=t.querySelector("#upload-file"),r=t.querySelector(".img-upload__overlay"),s=t.querySelector("#upload-cancel"),o=t.querySelector("#upload-submit"),c=t.querySelector(".text__description"),a=t.querySelector(".scale__control--smaller"),i=t.querySelector(".scale__control--bigger"),l=t.querySelector(".scale__control--value"),d=t.querySelector(".img-upload__preview img"),u=(t.querySelector(".effects__list"),t.querySelector(".effect-level__slider")),m=t.querySelector(".effect-level__value"),p=t.querySelector(".img-upload__effect-level"),v=(e=100)=>{d.style.transform=`scale(${e/100})`,l.value=`${e}%`};a.addEventListener("click",(()=>{let e=parseInt(l.value,10)-25;e<25&&(e=25),v(e)})),i.addEventListener("click",(()=>{let e=parseInt(l.value,10)+25;e>100&&(e=100),v(e)}));const y=()=>{v()},_=[{name:"none",min:0,max:100,step:1},{name:"chrome",style:"grayscale",min:0,max:1,step:.1,units:""},{name:"sepia",style:"sepia",min:0,max:1,step:.1,units:""},{name:"marvin",style:"invert",min:0,max:100,step:1,units:"%"},{name:"phobos",style:"blur",min:0,max:3,step:.1,units:"px"},{name:"heat",style:"brightness",min:1,max:3,step:.1,units:""}],f=_[0];let L=f;const S=()=>L===f,g=()=>{p.classList.remove("hidden"),u.noUiSlider.updateOptions({range:{min:L.min,max:L.max},start:L.max,step:L.step}),S()&&p.classList.add("hidden")},h=()=>{L=f,g()};noUiSlider.create(u,{range:{min:f.min,max:f.max},start:f.max,step:f.step,connect:"lower",format:{to:function(e){return e},from:function(e){return parseFloat(e)}}}),g(),t.addEventListener("change",(e=>{e.target.classList.contains("effects__radio")&&(L=_.find((t=>t.name===e.target.value)),g())})),u.noUiSlider.on("update",(()=>{if(d.style.filter="none",d.className="",m.value="",S())return;const e=u.noUiSlider.get();d.style.filter=`${L.style}(${e}${L.units})`,d.classList.add(`effects__preview--${L.name}`),m.value=e}));const x=e=>{q(e)&&(e.preventDefault(),k())};function k(){t.reset(),r.classList.add("hidden"),e.classList.remove("modal-open"),n.value="",c.value="",y(),h(),document.removeEventListener("keydown",x)}const q=e=>"Escape"===e.key,E=e=>{q(e)&&(e.preventDefault(),C())},b=e=>{q(e)&&(e.preventDefault(),D(),document.addEventListener("keydown",x))};function w(e){e.target.matches(".success__inner")||e.target.matches(".error__inner")||(e.target.remove(),e.target.removeEventListener("click",w),document.removeEventListener("keydown",E),document.removeEventListener("keydown",b),e.target.matches(".success__button")||e.target.matches(".success")||(document.addEventListener("keydown",x),r.classList.remove("hidden")))}function C(){document.querySelector(".success").remove(),document.removeEventListener("keydown",E)}function D(){r.classList.remove("hidden"),document.querySelector(".error").remove(),document.removeEventListener("keydown",b)}const U=document.querySelector(".pictures"),$=document.querySelector("#picture").content.querySelector(".picture"),T=new Pristine(t,{classTo:"text__description-label",errorTextParent:"text__description-label",errorTextClass:"text__error-text"}),j=()=>{o.disabled=!1,o.textContent="Опубликовать"};var N,A;n.addEventListener("input",(()=>{!function(){r.classList.remove("hidden"),e.classList.add("modal-open"),document.addEventListener("keydown",x);const t=n.files[0];d.src=URL.createObjectURL(t)}()})),s.addEventListener("click",(()=>{k()})),N=e=>{const t=document.createDocumentFragment();e.forEach((({url:e,likes:n,comments:r})=>{const s=$.cloneNode(!0);s.querySelector(".picture__img").src=e,s.querySelector(".picture__comments").textContent=r,s.querySelector(".picture__likes").textContent=n,t.appendChild(s)})),U.appendChild(t)},A=()=>(e=>{const t=document.createElement("div");t.style.zIndex="100",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.right="0",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Ошибка загрузки",document.body.append(t),setTimeout((()=>{t.remove()}),1e4)})(),fetch("https://27.javascript.pages.academy/kekstagram-simple/data").then((e=>{if(e.ok)return e.json()})).then((e=>N(e))).catch((()=>A())),(n=>{t.addEventListener("input",(()=>{T.validate()?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")})),t.addEventListener("submit",(t=>{t.preventDefault(),T.validate()&&(o.disabled=!0,o.textContent="Сохраняю...",((e,t,n)=>{fetch("https://27.javascript.pages.academy/kekstagram-simple",{method:"POST",body:n}).then((n=>{n.ok?e():t()})).catch((()=>t()))})((()=>{n(),j(),(()=>{const t=document.querySelector("#success").content.querySelector(".success").cloneNode(!0);e.appendChild(t),document.addEventListener("keydown",E),t.querySelector(".success__button").addEventListener("click",C),t.addEventListener("click",w)})()}),(()=>{(()=>{r.classList.add("hidden");const t=document.querySelector("#error").content.querySelector(".error").cloneNode(!0);e.appendChild(t),document.removeEventListener("keydown",x),document.addEventListener("keydown",b),t.querySelector(".error__button").addEventListener("click",D),t.addEventListener("click",w)})(),j()}),new FormData(t.target)))}))})(k)})();